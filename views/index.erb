<html>
  <head>
    <meta name="viewport" content= "width=device-width, initial-scale=1.0"> 
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
  </head>
  <body>
    <% pre_classes = "my-4 p-2 border overflow-x-scroll rounded bg-gray-100" %>
    <div class="max-w-2xl m-auto py-8 px-4 mb-24">
      <img src="http://pngimg.com/uploads/ruby/ruby_PNG47.png" class="h-12" />
      <h1 class="text-2xl font-black mb-10">
        Ruby App
      </h1>
      <p class="mb-4">
        OK, welcome to Ruby App. A sample app for Promise Authentication.
      </p>
      <% if error %>
        <p class="rounded bg-red-400 text-white text-center p-8" >
          Verification failed with <%= error.class %>
        </p>
      <% else %>
        <p class="rounded bg-green-400 text-white text-center p-8" >
          You are logged in! ðŸŽ‰
        </p>
      <% end %>

      <p class="mt-4">
        The id_token you came with has the following content:
      </p>
      <pre class="<%= pre_classes %>">payload = <%= JSON.pretty_generate payload %></pre>
      <pre class="<%= pre_classes %>">header = <%= JSON.pretty_generate header %></pre>
      <p>
        That means you should be identified by the following string
      </p>
      <pre class="<%= pre_classes %>"><%= user_id %></pre>
      <p class="mt-4">
        The header of the JWT token looks like this:
      </p>
      <pre class="<%= pre_classes %>">header = <%= JSON.pretty_generate header %></pre>
      <p>
        Fetching the public key from
      </p>
      <pre class="<%= pre_classes %>"><%= jwks_url %></pre>
      <p>
        yeilds
      </p>
      <pre class="<%= pre_classes %>">jwks = <%= JSON.pretty_generate jwks %></pre>
      <p>
        Now, this can be used to verify that the token is actually issued by <span class="font-mono"><%= payload['iss'] %></span>
      </p>

      <p class="mt-4">
        Check out the <a class="underline" href="https://github.com/promise-authentication/sample-ruby">source on GitHub</a> for this site.
      </p>

      <p class="mt-2">
        <a href="https://promiseauthentication.org/a/ruby.promiseauthentication.org?nonce=<%= SecureRandom.uuid %>" class="inline-block mt-8 px-8 py-4 bg-green-600 text-white rounded">Login again</a>
      </p>

      <p class="mt-2">
        <a href="https://ruby.promiseauthentication.org/.well-known/promise.json" class="underline">Chech out the configuration for Promise</a>
      </p>
    </div>
  </body>

</html>
